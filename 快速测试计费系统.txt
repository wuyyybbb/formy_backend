==================================================
  å¿«é€Ÿæµ‹è¯•è®¡è´¹ç³»ç»Ÿï¼ˆç”¨æˆ·å¥—é¤ä½“ç³»ï¼‰
==================================================

ğŸ“‹ å‰ææ¡ä»¶
-----------
1. åç«¯æ­£åœ¨è¿è¡Œï¼š
   cd backend
   python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

2. Redis æ­£åœ¨è¿è¡Œ


ğŸ§ª æµ‹è¯•æ–¹æ³• 1: è‡ªåŠ¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
-----------
cd backend
python test_billing_api.py

æ­¥éª¤ï¼š
1. è„šæœ¬ä¼šæç¤ºä½ è¾“å…¥æµ‹è¯•é‚®ç®±ï¼ˆé»˜è®¤ï¼štest_billing@example.comï¼‰
2. è„šæœ¬ä¼šå‘é€éªŒè¯ç åˆ°é‚®ç®±
3. è¾“å…¥æ”¶åˆ°çš„éªŒè¯ç 
4. è‡ªåŠ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼š
   âœ“ æŸ¥çœ‹åˆå§‹è®¡è´¹ä¿¡æ¯
   âœ“ åˆ‡æ¢åˆ° STARTER å¥—é¤
   âœ“ åˆ‡æ¢åˆ° PRO å¥—é¤
   âœ“ æ¶ˆè€—ç®—åŠ›
   âœ“ å¢åŠ ç®—åŠ›
   âœ“ åˆ‡æ¢åˆ° ULTIMATE å¥—é¤

é¢„æœŸç»“æœï¼š
- æ¯æ¬¡åˆ‡æ¢å¥—é¤åï¼Œç®—åŠ›ä¼šé‡ç½®ä¸ºæ–°å¥—é¤çš„é¢åº¦
- æ¶ˆè€—ç®—åŠ›åï¼Œå‰©ä½™ç®—åŠ›å‡å°‘
- å¢åŠ ç®—åŠ›åï¼Œå‰©ä½™ç®—åŠ›å¢åŠ 


ğŸŒ æµ‹è¯•æ–¹æ³• 2: ä½¿ç”¨ Swagger UI
-----------
1. æ‰“å¼€æµè§ˆå™¨ï¼šhttp://localhost:8000/docs

2. æ‰¾åˆ° "auth" æ ‡ç­¾ï¼Œå…ˆç™»å½•è·å– tokenï¼š
   - POST /auth/send-code - å‘é€éªŒè¯ç 
   - POST /auth/login - ç™»å½•è·å– token

3. ç‚¹å‡»é¡µé¢å³ä¸Šè§’ ğŸ”“ Authorize æŒ‰é’®
   - è¾“å…¥: Bearer YOUR_TOKEN_HERE
   - ç‚¹å‡» Authorize

4. æ‰¾åˆ° "billing" æ ‡ç­¾ï¼Œæµ‹è¯•æ¥å£ï¼š
   - GET /api/v1/billing/me - æŸ¥çœ‹è®¡è´¹ä¿¡æ¯
   - POST /api/v1/billing/change_plan - åˆ‡æ¢å¥—é¤


ğŸ’» æµ‹è¯•æ–¹æ³• 3: ä½¿ç”¨ PowerShell
-----------
# Step 1: ç™»å½•è·å– token
$email = "test@example.com"

# å‘é€éªŒè¯ç 
Invoke-RestMethod -Uri "http://localhost:8000/api/v1/auth/send-code" -Method Post -Body (@{email=$email} | ConvertTo-Json) -ContentType "application/json"

# ä½¿ç”¨éªŒè¯ç ç™»å½•ï¼ˆæ›¿æ¢ 123456 ä¸ºå®é™…éªŒè¯ç ï¼‰
$loginResponse = Invoke-RestMethod -Uri "http://localhost:8000/api/v1/auth/login" -Method Post -Body (@{email=$email;code="123456"} | ConvertTo-Json) -ContentType "application/json"
$token = $loginResponse.access_token
Write-Host "Token: $token"

# Step 2: æŸ¥çœ‹è®¡è´¹ä¿¡æ¯
$headers = @{Authorization="Bearer $token"}
Invoke-RestMethod -Uri "http://localhost:8000/api/v1/billing/me" -Method Get -Headers $headers | ConvertTo-Json -Depth 10

# Step 3: åˆ‡æ¢åˆ° PRO å¥—é¤
$body = @{plan_id="pro"} | ConvertTo-Json
Invoke-RestMethod -Uri "http://localhost:8000/api/v1/billing/change_plan" -Method Post -Headers $headers -Body $body -ContentType "application/json" | ConvertTo-Json -Depth 10

# Step 4: å†æ¬¡æŸ¥çœ‹è®¡è´¹ä¿¡æ¯
Invoke-RestMethod -Uri "http://localhost:8000/api/v1/billing/me" -Method Get -Headers $headers | ConvertTo-Json -Depth 10


ğŸ” æµ‹è¯•æ–¹æ³• 4: ä½¿ç”¨ curl
-----------
# Step 1: ç™»å½•è·å– token
curl -X POST http://localhost:8000/api/v1/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com"}'

curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","code":"123456"}'

# å¤åˆ¶ access_tokenï¼Œæ›¿æ¢ä¸‹é¢çš„ YOUR_TOKEN

# Step 2: æŸ¥çœ‹è®¡è´¹ä¿¡æ¯
curl -X GET http://localhost:8000/api/v1/billing/me \
  -H "Authorization: Bearer YOUR_TOKEN"

# Step 3: åˆ‡æ¢åˆ° PRO å¥—é¤
curl -X POST http://localhost:8000/api/v1/billing/change_plan \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"plan_id":"pro"}'

# Step 4: å†æ¬¡æŸ¥çœ‹è®¡è´¹ä¿¡æ¯
curl -X GET http://localhost:8000/api/v1/billing/me \
  -H "Authorization: Bearer YOUR_TOKEN"


ğŸ“Š é¢„æœŸå“åº”ç¤ºä¾‹
-----------
GET /billing/me å“åº”ï¼š
{
  "user_id": "user_abc123",
  "email": "test@example.com",
  "current_plan_id": "pro",
  "current_plan_name": "PRO",
  "current_credits": 12000,
  "monthly_credits": 12000,
  "total_credits_used": 0,
  "plan_renew_at": "2025-12-01T00:00:00",
  "credits_usage_percentage": 0.0
}

POST /billing/change_plan å“åº”ï¼š
{
  "success": true,
  "message": "æˆåŠŸåˆ‡æ¢åˆ° PRO å¥—é¤",
  "new_plan_id": "pro",
  "new_plan_name": "PRO",
  "new_credits": 12000,
  "plan_renew_at": "2025-12-01T00:00:00"
}


âœ… éªŒè¯è¦ç‚¹
-----------
1. åˆ‡æ¢å¥—é¤åï¼š
   - current_plan_id åº”è¯¥æ›´æ–°
   - current_credits åº”è¯¥é‡ç½®ä¸ºæ–°å¥—é¤çš„é¢åº¦
   - plan_renew_at åº”è¯¥è®¾ç½®ä¸ºä¸‹ä¸ªæœˆ 1 å·

2. æ¶ˆè€—ç®—åŠ›åï¼š
   - current_credits å‡å°‘
   - total_credits_used å¢åŠ 

3. å¢åŠ ç®—åŠ›åï¼š
   - current_credits å¢åŠ 

4. ä½¿ç”¨ç™¾åˆ†æ¯”ï¼š
   - credits_usage_percentage = (used / monthly) * 100


ğŸ¯ æµ‹è¯•å¥—é¤åˆ‡æ¢åºåˆ—
-----------
å»ºè®®æµ‹è¯•é¡ºåºï¼š
1. æ— å¥—é¤ â†’ STARTERï¼ˆÂ¥49ï¼Œ2000 ç®—åŠ›ï¼‰
2. STARTER â†’ BASICï¼ˆÂ¥99ï¼Œ5000 ç®—åŠ›ï¼‰
3. BASIC â†’ PROï¼ˆÂ¥199ï¼Œ12000 ç®—åŠ›ï¼‰
4. PRO â†’ ULTIMATEï¼ˆÂ¥399ï¼Œ30000 ç®—åŠ›ï¼‰
5. ULTIMATE â†’ STARTERï¼ˆé™çº§æµ‹è¯•ï¼‰


âš ï¸ æ³¨æ„äº‹é¡¹
-----------
1. MVP é˜¶æ®µä¸æ¥å…¥çœŸå®æ”¯ä»˜ï¼Œåˆ‡æ¢å¥—é¤ç«‹å³ç”Ÿæ•ˆ
2. åˆ‡æ¢å¥—é¤ä¼šé‡ç½®ç®—åŠ›ä¸ºæ–°å¥—é¤çš„æœˆåº¦é¢åº¦
3. ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ Redis ä¸­
4. éœ€è¦å…ˆç™»å½•è·å– token æ‰èƒ½è®¿é—®è®¡è´¹æ¥å£


â“ å¸¸è§é—®é¢˜
-----------
Q: è¿”å› 401 Unauthorizedï¼Ÿ
A: token æ— æ•ˆæˆ–è¿‡æœŸï¼Œéœ€è¦é‡æ–°ç™»å½•

Q: è¿”å› 404 ç”¨æˆ·ä¸å­˜åœ¨ï¼Ÿ
A: ç”¨æˆ·æ•°æ®åœ¨ Redis ä¸­ä¸å­˜åœ¨ï¼Œéœ€è¦å…ˆç™»å½•åˆ›å»ºç”¨æˆ·

Q: åˆ‡æ¢å¥—é¤åç®—åŠ›æ²¡å˜ï¼Ÿ
A: æ£€æŸ¥æ˜¯å¦è°ƒç”¨äº†æ­£ç¡®çš„æ¥å£ï¼ŒæŸ¥çœ‹å“åº”ä¸­çš„ new_credits

Q: å¦‚ä½•é‡ç½®æµ‹è¯•æ•°æ®ï¼Ÿ
A: é‡å¯ Redis æˆ–åˆ é™¤å¯¹åº”çš„ç”¨æˆ· key


ğŸ“š ç›¸å…³æ–‡æ¡£
-----------
- è¯¦ç»†å®ç°è¯´æ˜ï¼šç”¨æˆ·å¥—é¤ä½“ç³»å®ç°è¯´æ˜.md
- API æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- å¥—é¤é…ç½®ï¼šbackend/app/config/plans.py

