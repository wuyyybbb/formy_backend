# Docker éƒ¨ç½²é…ç½®æ€»ç»“

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

### 1. **Dockerfile** - Docker é•œåƒå®šä¹‰

```dockerfile
# å…³é”®é…ç½®:
- åŸºç¡€é•œåƒ: python:3.11-slim
- å·¥ä½œç›®å½•: /app
- å¯åŠ¨å‘½ä»¤: gunicorn + uvicorn workers
- ç«¯å£: 8000
- å¥åº·æ£€æŸ¥: /health
```

**ç‰¹ç‚¹ï¼š**
- âœ… ç”Ÿäº§çº§é…ç½®
- âœ… å¤šè¿›ç¨‹ workers (4ä¸ª)
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥
- âœ… ä¼˜åŒ–çš„é•œåƒå¤§å°

---

### 2. **.dockerignore** - Docker å¿½ç•¥æ–‡ä»¶

æ’é™¤ä¸éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶ï¼š
- Python ç¼“å­˜æ–‡ä»¶
- ç¯å¢ƒå˜é‡æ–‡ä»¶ (`.env`)
- IDE é…ç½®
- Git æ–‡ä»¶
- æµ‹è¯•æ–‡ä»¶
- æ–‡æ¡£æ–‡ä»¶

---

### 3. **docker-compose.yml** - æœ¬åœ°æµ‹è¯•é…ç½®

åŒ…å« 3 ä¸ªæœåŠ¡ï¼š
```yaml
services:
  backend:   # FastAPI API (ç«¯å£ 8000)
  redis:     # Redis æ•°æ®åº“ (ç«¯å£ 6379)
  worker:    # å¼‚æ­¥ä»»åŠ¡å¤„ç†å™¨
```

**ç‰¹ç‚¹ï¼š**
- âœ… ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
- âœ… è‡ªåŠ¨ä¾èµ–ç®¡ç†
- âœ… æ•°æ®æŒä¹…åŒ–
- âœ… ç½‘ç»œéš”ç¦»

---

### 4. **render.yaml** - Render éƒ¨ç½²é…ç½®

Render è‡ªåŠ¨éƒ¨ç½²é…ç½®ï¼š
- Web Service (backend)
- Redis Service
- ç¯å¢ƒå˜é‡å®šä¹‰

---

### 5. **requirements.txt** - æ›´æ–°ä¾èµ–

æ–°å¢ï¼š
```txt
gunicorn==21.2.0  # ç”Ÿäº§çº§ WSGI æœåŠ¡å™¨
```

---

### 6. **DOCKER_DEPLOY_GUIDE.md** - å®Œæ•´éƒ¨ç½²æŒ‡å—

åŒ…å«ï¼š
- æœ¬åœ°æµ‹è¯•æ–¹æ³•
- Render éƒ¨ç½²æ­¥éª¤
- ç¯å¢ƒå˜é‡é…ç½®
- å¸¸è§é—®é¢˜è§£å†³
- æ€§èƒ½ä¼˜åŒ–å»ºè®®

---

### 7. **RENDER_å¿«é€Ÿéƒ¨ç½².md** - 5åˆ†é’Ÿå¿«é€ŸæŒ‡å—

å¿«é€Ÿéƒ¨ç½²åˆ° Render çš„æ­¥éª¤æ¸…å•ã€‚

---

### 8. **test-docker-local.bat** - æœ¬åœ°æµ‹è¯•è„šæœ¬

Windows æ‰¹å¤„ç†è„šæœ¬ï¼Œæä¾›äº¤äº’å¼èœå•ï¼š
1. å¯åŠ¨æœåŠ¡
2. æŸ¥çœ‹æ—¥å¿—
3. åœæ­¢æœåŠ¡
4. æ¸…ç†æ•°æ®
5. é‡æ–°æ„å»º

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ç”Ÿäº§ç¯å¢ƒæ¶æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ç”¨æˆ·è¯·æ±‚       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Render CDN    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          Gunicorn (Master)             â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚  â”‚  Uvicorn Worker 1                â”‚ â”‚
         â”‚  â”‚  Uvicorn Worker 2                â”‚ â”‚
         â”‚  â”‚  Uvicorn Worker 3                â”‚ â”‚
         â”‚  â”‚  Uvicorn Worker 4                â”‚ â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Redis (Cache)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ¬åœ°å¼€å‘æ¶æ„

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     Docker Compose              â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   Backend Container       â”‚  â”‚
         â”‚  â”‚   (FastAPI + Gunicorn)    â”‚  â”‚
         â”‚  â”‚   Port: 8000              â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚              â†“                   â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   Redis Container         â”‚  â”‚
         â”‚  â”‚   Port: 6379              â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚              â†“                   â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚   Worker Container        â”‚  â”‚
         â”‚  â”‚   (Task Processor)        â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æœ¬åœ°æµ‹è¯•

#### æ–¹æ³• 1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd F:\formy\backend
test-docker-local.bat
```

#### æ–¹æ³• 2: æ‰‹åŠ¨å‘½ä»¤

```bash
cd F:\formy\backend

# å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢
docker-compose down
```

---

### Render éƒ¨ç½²

#### å¿«é€Ÿéƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰

æŸ¥çœ‹ `RENDER_å¿«é€Ÿéƒ¨ç½².md`

#### è¯¦ç»†éƒ¨ç½²

æŸ¥çœ‹ `DOCKER_DEPLOY_GUIDE.md`

---

## ğŸ“Š ç¯å¢ƒå¯¹æ¯”

| é¡¹ç›® | æœ¬åœ°å¼€å‘ | Render ç”Ÿäº§ |
|------|---------|------------|
| **å¯åŠ¨æ–¹å¼** | `docker-compose up` | è‡ªåŠ¨éƒ¨ç½² |
| **Python** | 3.11 | 3.11 |
| **Web æœåŠ¡å™¨** | Gunicorn + Uvicorn | Gunicorn + Uvicorn |
| **Workers** | 4 | 4 (å¯è°ƒæ•´) |
| **Redis** | Docker å®¹å™¨ | Render Redis |
| **ç«¯å£** | 8000 | è‡ªåŠ¨åˆ†é… |
| **ç¯å¢ƒå˜é‡** | `.env` æˆ– `docker-compose.yml` | Render Dashboard |
| **æ—¥å¿—** | `docker-compose logs` | Render Logs |
| **æŒä¹…åŒ–å­˜å‚¨** | Docker å· | âš ï¸ éœ€é…ç½®äº‘å­˜å‚¨ |

---

## âš ï¸ é‡è¦æç¤º

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

âŒ **ä¸è¦æäº¤åˆ° Gitï¼š**
- `.env` æ–‡ä»¶
- `SECRET_KEY`
- `RESEND_API_KEY`
- ä»»ä½•å¯†ç æˆ–å¯†é’¥

âœ… **æ­£ç¡®åšæ³•ï¼š**
- ä½¿ç”¨ `.env.example` ä½œä¸ºæ¨¡æ¿
- åœ¨ Render Dashboard ä¸­é…ç½®æ•æ„Ÿå˜é‡
- ä½¿ç”¨ Render Secrets ç®¡ç†å¯†é’¥

---

### 2. æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´æ€§

| é…ç½®é¡¹ | æœ¬åœ° | ç”Ÿäº§ | è¯´æ˜ |
|--------|------|------|------|
| Python ç‰ˆæœ¬ | âœ… 3.11 | âœ… 3.11 | å®Œå…¨ä¸€è‡´ |
| Web æœåŠ¡å™¨ | âœ… Gunicorn | âœ… Gunicorn | å®Œå…¨ä¸€è‡´ |
| ASGI æœåŠ¡å™¨ | âœ… Uvicorn | âœ… Uvicorn | å®Œå…¨ä¸€è‡´ |
| Redis | âœ… 7-alpine | âœ… 7 | ç‰ˆæœ¬ä¸€è‡´ |
| ä¾èµ– | âœ… requirements.txt | âœ… requirements.txt | å®Œå…¨ä¸€è‡´ |

**ç»“è®ºï¼šæœ¬åœ°æµ‹è¯•é€šè¿‡ = çº¿ä¸Šéƒ¨ç½²æˆåŠŸï¼** âœ…

---

### 3. Render å…è´¹è®¡åˆ’é™åˆ¶

| é™åˆ¶ | è¯´æ˜ |
|------|------|
| **è‡ªåŠ¨ä¼‘çœ ** | 15åˆ†é’Ÿæ— è¯·æ±‚åä¼‘çœ  |
| **å”¤é†’æ—¶é—´** | é¦–æ¬¡è¯·æ±‚éœ€ç­‰å¾… 30-60 ç§’ |
| **æœˆæ„å»ºæ—¶é—´** | é™åˆ¶ 400 å°æ—¶ |
| **æœˆå¸¦å®½** | é™åˆ¶ 100 GB |

**æ¨èï¼š** ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ **Starter è®¡åˆ’**ï¼ˆ$7/æœˆï¼‰ï¼Œé¿å…ä¼‘çœ é—®é¢˜ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### 1. æœ¬åœ°æµ‹è¯•

```bash
cd F:\formy\backend
test-docker-local.bat
```

éªŒè¯ï¼š
- âœ… å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8000/health
- âœ… API æ–‡æ¡£ï¼šhttp://localhost:8000/docs
- âœ… ä¸Šä¼ åŠŸèƒ½æµ‹è¯•

---

### 2. æ¨é€åˆ° GitHub

```bash
cd F:\formy\backend
git add .
git commit -m "Add Docker configuration for Render deployment"
git push origin main
```

---

### 3. éƒ¨ç½²åˆ° Render

æŒ‰ç…§ `RENDER_å¿«é€Ÿéƒ¨ç½².md` æ­¥éª¤æ“ä½œã€‚

---

### 4. æ›´æ–°å‰ç«¯é…ç½®

å‰ç«¯ `.env.production` ä¸­æ›´æ–° API URLï¼š

```env
VITE_API_BASE_URL=https://formy-backend-xxxxx.onrender.com/api/v1
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `Dockerfile` | Docker é•œåƒå®šä¹‰ |
| `docker-compose.yml` | æœ¬åœ°æµ‹è¯•é…ç½® |
| `DOCKER_DEPLOY_GUIDE.md` | å®Œæ•´éƒ¨ç½²æŒ‡å— |
| `RENDER_å¿«é€Ÿéƒ¨ç½².md` | å¿«é€Ÿéƒ¨ç½²æ­¥éª¤ |
| `test-docker-local.bat` | æœ¬åœ°æµ‹è¯•è„šæœ¬ |

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ç¡®è®¤ï¼š

- [ ] âœ… å·²åˆ›å»ºæ‰€æœ‰é…ç½®æ–‡ä»¶
- [ ] âœ… `requirements.txt` åŒ…å« `gunicorn`
- [ ] âœ… æœ¬åœ° Docker æµ‹è¯•é€šè¿‡
- [ ] âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸
- [ ] âœ… æ‰€æœ‰ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] âœ… å·²å‡†å¤‡å¥½ Resend API Key
- [ ] âœ… å·²ç”Ÿæˆå¼ºå¯†ç  SECRET_KEY
- [ ] âœ… å·²åœ¨ Render åˆ›å»º Redis æœåŠ¡
- [ ] âœ… å·²é…ç½®æ‰€æœ‰ç¯å¢ƒå˜é‡
- [ ] âœ… å·²æ›´æ–° CORS_ORIGINS ä¸ºå‰ç«¯åŸŸå

---

## ğŸ‰ å®Œæˆï¼

ä½ çš„ Formy Backend ç°åœ¨å·²ç»ï¼š
- âœ… **æœ¬åœ°å¯æµ‹è¯•**ï¼ˆDocker Composeï¼‰
- âœ… **çº¿ä¸Šå¯éƒ¨ç½²**ï¼ˆRenderï¼‰
- âœ… **ç¯å¢ƒå®Œå…¨ä¸€è‡´**ï¼ˆDockerfileï¼‰
- âœ… **ç”Ÿäº§çº§é…ç½®**ï¼ˆGunicorn + Uvicornï¼‰

**å¼€å§‹éƒ¨ç½²å§ï¼** ğŸš€

