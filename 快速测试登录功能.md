# 快速测试登录功能

## 🚀 启动步骤

### 1. 启动后端
```bash
cd backend
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 启动前端
```bash
cd frontend
npm run dev
```

### 3. 访问应用
打开浏览器访问：http://localhost:5173

---

## 🧪 测试流程

### 测试 1：记忆邮箱功能
1. ✅ 点击页面右上角"登录"按钮
2. ✅ 输入邮箱：`test@example.com`
3. ✅ 点击"发送验证码"
4. ✅ 关闭登录弹窗（点击 X 或遮罩层）
5. ✅ 重新点击"登录"按钮
6. ✅ **检查：邮箱地址是否自动填充为 `test@example.com`**

### 测试 2：验证码输入优化
1. ✅ 输入邮箱并发送验证码
2. ✅ 进入验证码输入界面
3. ✅ **检查：显示 "0/6" 进度提示**
4. ✅ 输入数字（只允许输入数字）
5. ✅ **检查：每输入一位，进度更新（1/6, 2/6...）**
6. ✅ 输入满 6 位
7. ✅ **检查：自动触发登录（无需点击按钮）**

### 测试 3：粘贴验证码
1. ✅ 复制验证码：`123456`
2. ✅ 在验证码输入框中粘贴（Ctrl+V）
3. ✅ **检查：自动填充并触发登录**

### 测试 4：错误处理
1. ✅ 输入错误的邮箱格式：`test@`
2. ✅ **检查：显示"请输入有效的邮箱地址"**
3. ✅ 输入正确邮箱但不存在 Redis/Resend 配置
4. ✅ **检查：显示友好的错误提示**

---

## 🔍 调试技巧

### 1. 查看浏览器控制台
按 F12 打开开发者工具，查看：
- **Console 标签**：查看日志和错误
- **Network 标签**：查看 API 请求和响应
- **Application 标签 > Local Storage**：查看保存的邮箱地址

### 2. 查看后端日志
终端中应该显示：
```
✅ Redis 连接成功: localhost:6379
🔧 邮件服务初始化:
   - API Key: 已配置 / ❌ 未配置
   - From Email: onboarding@resend.dev

📧 收到发送验证码请求: test@example.com
🔑 生成验证码: 123456 (仅用于调试，生产环境应删除)
💾 正在保存验证码到 Redis...
💾 保存结果: True
📤 正在发送邮件到 test@example.com...
✅ 验证码发送成功: test@example.com
```

### 3. 检查 localStorage
在浏览器控制台执行：
```javascript
// 查看保存的邮箱
console.log(localStorage.getItem('formy_remembered_email'))

// 查看保存的 token
console.log(localStorage.getItem('formy_auth_token'))

// 清除数据
localStorage.clear()
```

---

## ⚠️ 常见问题

### 问题 1：看不到登录按钮
**原因：** 可能在不同的页面  
**解决：** 检查是在首页 (/) 还是编辑器 (/editor)

### 问题 2：点击发送验证码后没反应
**检查：**
1. 打开 F12 查看 Network 标签
2. 查看是否有 `send-code` 请求
3. 查看请求的状态码和响应内容
4. 检查后端是否正常运行

### 问题 3：验证码一直不到
**原因：**
1. Resend API Key 未配置
2. Redis 连接失败

**解决：**
查看后端日志中的详细错误信息

### 问题 4：isDragging 错误仍然出现
**解决方案：**
```bash
# 停止前端开发服务器（Ctrl+C）
# 清除缓存并重新启动
cd frontend
rm -rf node_modules/.vite
npm run dev
```

---

## 📸 预期效果截图

### 登录弹窗 - 输入邮箱
```
┌─────────────────────────────────┐
│           [F]                   │
│       登录 Formy                │
│    使用邮箱验证码登录           │
├─────────────────────────────────┤
│ 邮箱地址                        │
│ ┌─────────────────────────────┐ │
│ │ test@example.com (自动填充) │ │
│ └─────────────────────────────┘ │
│                                 │
│ [     发送验证码     ]          │
└─────────────────────────────────┘
```

### 验证码输入界面
```
┌─────────────────────────────────┐
│           [F]                   │
│       输入验证码                │
│  验证码已发送到 test@example.com│
├─────────────────────────────────┤
│ 验证码              [6/6]       │
│ ┌─────────────────────────────┐ │
│ │      1 2 3 4 5 6            │ │
│ └─────────────────────────────┘ │
│ 💡 提示：输入完成后会自动登录   │
│                                 │
│ [       登录       ]            │
│                                 │
│ ← 返回        重新发送 (60s)    │
└─────────────────────────────────┘
```

---

## ✅ 测试检查清单

**前端功能：**
- [ ] 登录按钮可点击
- [ ] 登录弹窗正常显示
- [ ] 邮箱自动填充（第二次打开）
- [ ] 邮箱格式验证
- [ ] 发送验证码按钮正常
- [ ] 60秒倒计时正常
- [ ] 验证码输入进度显示
- [ ] 只能输入数字
- [ ] 粘贴验证码功能
- [ ] 输入6位自动登录
- [ ] 错误提示正常显示
- [ ] 成功登录后弹窗关闭

**后端功能：**
- [ ] Redis 连接成功
- [ ] 验证码生成正常
- [ ] 验证码保存到 Redis
- [ ] 邮件发送成功（如配置了 Resend）
- [ ] 验证码验证正常
- [ ] JWT token 生成
- [ ] 用户信息返回

**记忆功能：**
- [ ] localStorage 保存邮箱
- [ ] 下次打开自动填充
- [ ] 清除缓存后恢复默认

---

## 🎯 性能检查

### 响应时间
- 发送验证码：< 3 秒
- 登录验证：< 1 秒
- 自动登录触发：< 500ms

### 用户体验
- 加载动画流畅
- 按钮状态变化清晰
- 错误提示友好
- 无卡顿现象

---

## 📝 测试报告模板

```markdown
## 登录功能测试报告

测试时间：2025-11-20
测试环境：本地开发环境

### 功能测试结果
1. 记忆邮箱功能：✅ 通过 / ❌ 失败
   - 问题描述：

2. 验证码输入优化：✅ 通过 / ❌ 失败
   - 问题描述：

3. 自动登录功能：✅ 通过 / ❌ 失败
   - 问题描述：

4. 错误处理：✅ 通过 / ❌ 失败
   - 问题描述：

### 发现的问题
1. 
2. 
3. 

### 建议改进
1. 
2. 
3. 
```

---

**祝测试顺利！** 🎉

如有问题，请查看详细配置指南：`登录功能配置与排错指南.md`

