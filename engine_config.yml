# Engine 配置文件示例
# 定义所有可用的 Engine 和 Pipeline → Engine 映射关系

# ============================================
# Engine 定义
# ============================================
engines:
  # 人脸检测 API
  face_detection_api:
    type: external_api
    config:
      api_url: "https://api.example.com/face-detection"
      api_key: "${FACE_DETECTION_API_KEY}"
      timeout: 30
  
  # 人脸替换 API
  face_swap_api:
    type: external_api
    config:
      api_url: "https://api.example.com/face-swap"
      api_key: "${FACE_SWAP_API_KEY}"
      timeout: 60
  
  # 人像分割 API
  segmentation_api:
    type: external_api
    config:
      api_url: "https://api.example.com/segmentation"
      api_key: "${SEGMENTATION_API_KEY}"
      timeout: 30
  
  # ComfyUI 换头工作流
  comfyui_head_swap:
    type: comfyui
    config:
      comfyui_url: "http://localhost:8188"
      workflow_path: "./workflows/head_swap_workflow.json"
      timeout: 300
  
  # ComfyUI 换背景工作流
  comfyui_background:
    type: comfyui
    config:
      comfyui_url: "http://localhost:8188"
      workflow_path: "./workflows/background_workflow.json"
      timeout: 300
  
  # ComfyUI 姿势迁移工作流
  comfyui_pose_transfer:
    type: comfyui
    config:
      comfyui_url: "${COMFYUI_BASE_URL}"  # ComfyUI 服务地址（从环境变量读取）
      workflow_path: "./workflows/pose_swap_workflow.json"
      timeout: ${COMFYUI_TIMEOUT:300}  # 超时时间（秒），默认300
      poll_interval: ${COMFYUI_POLL_INTERVAL:2}  # 轮询间隔（秒），默认2
      timeout: ${COMFYUI_TIMEOUT:300}  # 超时时间（秒），默认300
      poll_interval: ${COMFYUI_POLL_INTERVAL:2}  # 轮询间隔（秒），默认2

# ============================================
# Pipeline 配置
# ============================================
pipelines:
  # 换头 Pipeline
  head_swap:
    enabled: true
    steps:
      face_detection:
        engine: face_detection_api
        description: "检测人脸"
      face_swap:
        engine: face_swap_api
        description: "替换人脸"
      # 可选：使用 ComfyUI 完整工作流
      # full_workflow:
      #   engine: comfyui_head_swap
      #   description: "完整换头流程"
  
  # 换背景 Pipeline
  background_change:
    enabled: true
    steps:
      segmentation:
        engine: segmentation_api
        description: "人像分割"
      # 可选：使用 ComfyUI 完整工作流
      # full_workflow:
      #   engine: comfyui_background
      #   description: "完整换背景流程"
  
  # 换姿势 Pipeline
  pose_change:
    enabled: true
    steps:
      pose_transfer:
        engine: comfyui_pose_transfer
        description: "姿势迁移"

# ============================================
# 全局配置
# ============================================
global:
  # 重试配置
  retry:
    max_attempts: 3
    retry_delay: 2  # 秒
  
  # 超时配置
  timeout:
    default: 60
    max: 300
  
  # 缓存配置（可选）
  cache:
    enabled: false
    ttl: 3600  # 秒

