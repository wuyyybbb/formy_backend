# å¥—é¤é…ç½®ç³»ç»Ÿå®ç°è¯´æ˜

## âœ… å®Œæˆå†…å®¹

å·²åœ¨åç«¯æ·»åŠ å®Œæ•´çš„å¥—é¤é…ç½®ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ•°æ®æ¨¡å‹ã€é…ç½®ç®¡ç†å’Œ API æ¥å£ã€‚

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ plan.py                 # å¥—é¤ Pydantic æ¨¡å‹
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ __init__.py            # é…ç½®æ¨¡å—åˆå§‹åŒ–
â”‚   â”‚   â””â”€â”€ plans.py               # å¥—é¤å®˜æ–¹æ•°æ®ï¼ˆç¡¬ç¼–ç ï¼‰
â”‚   â”œâ”€â”€ api/v1/
â”‚   â”‚   â””â”€â”€ routes_plans.py        # å¥—é¤ API è·¯ç”±
â”‚   â””â”€â”€ main.py                    # æ³¨å†Œè·¯ç”±
â””â”€â”€ test_plans_api.py              # API æµ‹è¯•è„šæœ¬
```

---

## ğŸ¯ æ ¸å¿ƒå®ç°

### 1. æ•°æ®æ¨¡å‹ï¼ˆ`backend/app/schemas/plan.py`ï¼‰

å®šä¹‰äº†å¥—é¤é…ç½®çš„ Pydantic æ¨¡å‹ï¼š

```python
class Plan(BaseModel):
    plan_id: str              # å¥—é¤å”¯ä¸€æ ‡è¯† (starter/basic/pro/ultimate)
    name: str                 # å¥—é¤åç§° (STARTER/BASIC/PRO/ULTIMATE)
    price_month: int          # æœˆä»˜ä»·æ ¼ï¼ˆäººæ°‘å¸ï¼‰
    price_original: int       # åŸä»·ï¼ˆç”¨äºæ˜¾ç¤ºæŠ˜æ‰£ï¼‰
    monthly_credits: int      # æ¯æœˆç®—åŠ›é¢åº¦
    image_count: int          # å¤§çº¦å¯ç”Ÿæˆå›¾ç‰‡æ•°é‡
    is_featured: bool         # æ˜¯å¦æ¨èå¥—é¤
    features: List[str]       # åŠŸèƒ½åˆ—è¡¨
    sort_order: int           # æ’åºé¡ºåº
```

### 2. å¥—é¤é…ç½®æ•°æ®ï¼ˆ`backend/app/config/plans.py`ï¼‰

ç¡¬ç¼–ç çš„å®˜æ–¹å¥—é¤åˆ—è¡¨ï¼š

| å¥—é¤ | plan_id | ä»·æ ¼/æœˆ | åŸä»· | ç®—åŠ› | å›¾ç‰‡æ•° | æ¨è |
|------|---------|---------|------|------|--------|------|
| STARTER | starter | Â¥49 | Â¥59 | 2000 | ~50 | âŒ |
| BASIC | basic | Â¥99 | Â¥119 | 5000 | ~120 | âŒ |
| PRO | pro | Â¥199 | Â¥249 | 12000 | ~300 | â­ |
| ULTIMATE | ultimate | Â¥399 | Â¥499 | 30000 | ~750 | âŒ |

**æä¾›çš„å·¥å…·å‡½æ•°**ï¼š
- `get_all_plans()` - è·å–æ‰€æœ‰å¥—é¤ï¼ˆå·²æ’åºï¼‰
- `get_plan_by_id(plan_id)` - æ ¹æ® ID è·å–å¥—é¤
- `get_featured_plan()` - è·å–æ¨èå¥—é¤

### 3. API æ¥å£ï¼ˆ`backend/app/api/v1/routes_plans.py`ï¼‰

æä¾› 3 ä¸ªåªè¯»æ¥å£ï¼š

#### API 1: è·å–æ‰€æœ‰å¥—é¤
```http
GET /api/v1/plans
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "plans": [
    {
      "plan_id": "starter",
      "name": "STARTER",
      "price_month": 49,
      "price_original": 59,
      "monthly_credits": 2000,
      "image_count": 50,
      "is_featured": false,
      "features": [
        "åŸºç¡€ AI æ¢å¤´åŠŸèƒ½",
        "çº¦ 50 å¼ å›¾ç‰‡ç”Ÿæˆ",
        "æ ‡å‡†å¤„ç†é€Ÿåº¦"
      ],
      "sort_order": 0
    },
    // ... æ›´å¤šå¥—é¤
  ],
  "total": 4
}
```

#### API 2: è·å–å•ä¸ªå¥—é¤è¯¦æƒ…
```http
GET /api/v1/plans/{plan_id}
```

**ç¤ºä¾‹**ï¼š
```bash
GET /api/v1/plans/pro
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "plan_id": "pro",
  "name": "PRO",
  "price_month": 199,
  "price_original": 249,
  "monthly_credits": 12000,
  "image_count": 300,
  "is_featured": true,
  "features": [
    "å…¨éƒ¨ AI åŠŸèƒ½",
    "çº¦ 300 å¼ å›¾ç‰‡ç”Ÿæˆ",
    "æé€Ÿå¤„ç†",
    "é«˜çº§æ‰¹é‡å¤„ç†",
    "ä¼˜å…ˆå®¢æœæ”¯æŒ"
  ],
  "sort_order": 2
}
```

#### API 3: è·å–æ¨èå¥—é¤
```http
GET /api/v1/plans/featured/current
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "plan_id": "pro",
  "name": "PRO",
  "price_month": 199,
  // ... å®Œæ•´å¥—é¤ä¿¡æ¯
}
```

---

## ğŸš€ æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨åç«¯

ç¡®ä¿åç«¯æ­£åœ¨è¿è¡Œï¼š
```bash
cd backend
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. æŸ¥çœ‹ API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:8000/docs
```

åœ¨ Swagger UI ä¸­å¯ä»¥çœ‹åˆ°æ–°å¢çš„ **plans** æ ‡ç­¾ï¼ŒåŒ…å« 3 ä¸ªæ¥å£ã€‚

### 3. è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd backend
python test_plans_api.py
```

**æµ‹è¯•å†…å®¹**ï¼š
- âœ“ è·å–æ‰€æœ‰å¥—é¤åˆ—è¡¨
- âœ“ è·å–æ¯ä¸ªå¥—é¤çš„è¯¦æƒ…ï¼ˆstarter/basic/pro/ultimateï¼‰
- âœ“ è·å–æ¨èå¥—é¤
- âœ“ æµ‹è¯•ä¸å­˜åœ¨çš„å¥—é¤IDï¼ˆ404é”™è¯¯ï¼‰

### 4. æ‰‹åŠ¨æµ‹è¯•ï¼ˆä½¿ç”¨ curlï¼‰

**è·å–æ‰€æœ‰å¥—é¤**ï¼š
```bash
curl http://localhost:8000/api/v1/plans
```

**è·å– PRO å¥—é¤**ï¼š
```bash
curl http://localhost:8000/api/v1/plans/pro
```

**è·å–æ¨èå¥—é¤**ï¼š
```bash
curl http://localhost:8000/api/v1/plans/featured/current
```

---

## ğŸ¯ å‰ç«¯é›†æˆï¼ˆå¯é€‰ï¼‰

è™½ç„¶ MVP é˜¶æ®µå‰ç«¯å¯ä»¥å†™æ­»æ•°æ®ï¼Œä½†æœªæ¥å¯ä»¥ä»åç«¯è·å–ï¼š

### å‰ç«¯ API è°ƒç”¨ç¤ºä¾‹

åˆ›å»º `frontend/src/api/plans.ts`ï¼š

```typescript
import { apiClient } from './client'

export interface Plan {
  plan_id: string
  name: string
  price_month: number
  price_original: number
  monthly_credits: number
  image_count: number
  is_featured: boolean
  features: string[]
  sort_order: number
}

export interface PlanListResponse {
  plans: Plan[]
  total: number
}

// è·å–æ‰€æœ‰å¥—é¤
export async function getAllPlans(): Promise<PlanListResponse> {
  const response = await apiClient.get('/plans')
  return response.data
}

// è·å–å•ä¸ªå¥—é¤
export async function getPlan(planId: string): Promise<Plan> {
  const response = await apiClient.get(`/plans/${planId}`)
  return response.data
}

// è·å–æ¨èå¥—é¤
export async function getFeaturedPlan(): Promise<Plan> {
  const response = await apiClient.get('/plans/featured/current')
  return response.data
}
```

### åœ¨ LandingPage ä¸­ä½¿ç”¨

```typescript
import { useEffect, useState } from 'react'
import { getAllPlans, type Plan } from '../api/plans'

export default function LandingPage() {
  const [plans, setPlans] = useState<Plan[]>([])

  useEffect(() => {
    // ä»åç«¯è·å–å¥—é¤æ•°æ®
    getAllPlans().then(data => {
      setPlans(data.plans)
    }).catch(err => {
      console.error('è·å–å¥—é¤å¤±è´¥:', err)
      // ä½¿ç”¨é»˜è®¤æ•°æ®
    })
  }, [])

  // æ¸²æŸ“å¥—é¤å¡ç‰‡...
}
```

---

## ğŸ“‹ å¥—é¤è¯¦ç»†æ•°æ®

### STARTERï¼ˆå…¥é—¨ç‰ˆï¼‰
- **ä»·æ ¼**ï¼šÂ¥49/æœˆï¼ˆåŸä»· Â¥59ï¼‰
- **ç®—åŠ›**ï¼š2000/æœˆ
- **å›¾ç‰‡**ï¼šçº¦ 50 å¼ 
- **åŠŸèƒ½**ï¼š
  - åŸºç¡€ AI æ¢å¤´åŠŸèƒ½
  - çº¦ 50 å¼ å›¾ç‰‡ç”Ÿæˆ
  - æ ‡å‡†å¤„ç†é€Ÿåº¦

### BASICï¼ˆåŸºç¡€ç‰ˆï¼‰
- **ä»·æ ¼**ï¼šÂ¥99/æœˆï¼ˆåŸä»· Â¥119ï¼‰
- **ç®—åŠ›**ï¼š5000/æœˆ
- **å›¾ç‰‡**ï¼šçº¦ 120 å¼ 
- **åŠŸèƒ½**ï¼š
  - å…¨éƒ¨ AI åŠŸèƒ½
  - çº¦ 120 å¼ å›¾ç‰‡ç”Ÿæˆ
  - ä¼˜å…ˆå¤„ç†é€Ÿåº¦
  - æ‰¹é‡å¤„ç†

### PROï¼ˆä¸“ä¸šç‰ˆï¼‰â­ æ¨è
- **ä»·æ ¼**ï¼šÂ¥199/æœˆï¼ˆåŸä»· Â¥249ï¼‰
- **ç®—åŠ›**ï¼š12000/æœˆ
- **å›¾ç‰‡**ï¼šçº¦ 300 å¼ 
- **åŠŸèƒ½**ï¼š
  - å…¨éƒ¨ AI åŠŸèƒ½
  - çº¦ 300 å¼ å›¾ç‰‡ç”Ÿæˆ
  - æé€Ÿå¤„ç†
  - é«˜çº§æ‰¹é‡å¤„ç†
  - ä¼˜å…ˆå®¢æœæ”¯æŒ

### ULTIMATEï¼ˆæ——èˆ°ç‰ˆï¼‰
- **ä»·æ ¼**ï¼šÂ¥399/æœˆï¼ˆåŸä»· Â¥499ï¼‰
- **ç®—åŠ›**ï¼š30000/æœˆ
- **å›¾ç‰‡**ï¼šçº¦ 750 å¼ 
- **åŠŸèƒ½**ï¼š
  - å…¨éƒ¨ AI åŠŸèƒ½
  - çº¦ 750 å¼ å›¾ç‰‡ç”Ÿæˆ
  - æœ€é«˜ä¼˜å…ˆçº§å¤„ç†
  - æ— é™æ‰¹é‡å¤„ç†
  - ä¸“å±å®¢æœæ”¯æŒ
  - API æ¥å£è®¿é—®

---

## ğŸ”§ æœªæ¥æ‰©å±•

### 1. æ•°æ®åº“å­˜å‚¨
å°†å¥—é¤é…ç½®å­˜å…¥æ•°æ®åº“ï¼Œæ”¯æŒåŠ¨æ€ç®¡ç†ï¼š
```python
# æœªæ¥å¯ä»¥æ”¹ä¸ºä»æ•°æ®åº“è¯»å–
class PlanModel(Base):
    __tablename__ = "plans"
    id = Column(Integer, primary_key=True)
    plan_id = Column(String, unique=True)
    # ...
```

### 2. ç®¡ç†åå°
æ·»åŠ ç®¡ç†æ¥å£ï¼Œæ”¯æŒ CRUD æ“ä½œï¼š
- POST /admin/plans - åˆ›å»ºå¥—é¤
- PUT /admin/plans/{id} - æ›´æ–°å¥—é¤
- DELETE /admin/plans/{id} - åˆ é™¤å¥—é¤

### 3. ç”¨æˆ·è®¢é˜…
å…³è”ç”¨æˆ·è¡¨ï¼Œè®°å½•ç”¨æˆ·å½“å‰è®¢é˜…çš„å¥—é¤ï¼š
```python
class UserSubscription(Base):
    user_id = Column(String, ForeignKey("users.id"))
    plan_id = Column(String, ForeignKey("plans.plan_id"))
    start_date = Column(DateTime)
    end_date = Column(DateTime)
    # ...
```

### 4. æ”¯ä»˜é›†æˆ
é›†æˆæ”¯ä»˜æ¥å£ï¼ˆå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€Stripeç­‰ï¼‰ï¼š
- POST /api/v1/subscriptions/create - åˆ›å»ºè®¢é˜…è®¢å•
- POST /api/v1/payments/callback - æ”¯ä»˜å›è°ƒ

---

## âœ… éªŒè¯æ¸…å•

- [x] åˆ›å»º `Plan` æ•°æ®æ¨¡å‹
- [x] ç¡¬ç¼–ç  4 ä¸ªå®˜æ–¹å¥—é¤ï¼ˆstarter/basic/pro/ultimateï¼‰
- [x] å®ç° `get_all_plans()` å·¥å…·å‡½æ•°
- [x] å®ç° `get_plan_by_id()` å·¥å…·å‡½æ•°
- [x] å®ç° `get_featured_plan()` å·¥å…·å‡½æ•°
- [x] åˆ›å»º `GET /api/v1/plans` æ¥å£
- [x] åˆ›å»º `GET /api/v1/plans/{plan_id}` æ¥å£
- [x] åˆ›å»º `GET /api/v1/plans/featured/current` æ¥å£
- [x] åœ¨ `main.py` ä¸­æ³¨å†Œè·¯ç”±
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬
- [x] ç¼–å†™æ–‡æ¡£

---

## ğŸ‰ å®Œæˆï¼

å¥—é¤é…ç½®ç³»ç»Ÿå·²æˆåŠŸå®ç°ï¼ç°åœ¨åç«¯æœ‰äº†"å®˜æ–¹çœŸæ•°æ®"ï¼Œå‰ç«¯å¯ä»¥ï¼š
1. **MVP é˜¶æ®µ**ï¼šç»§ç»­ä½¿ç”¨å‰ç«¯ç¡¬ç¼–ç çš„æ•°æ®
2. **æœªæ¥è¿­ä»£**ï¼šä»åç«¯ API åŠ¨æ€è·å–å¥—é¤é…ç½®

è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š
- âœ… åç«¯æ˜¯å”¯ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰
- âœ… å‰ç«¯å¯ä»¥çµæ´»é€‰æ‹©æ˜¯å¦è°ƒç”¨
- âœ… æ˜“äºæ‰©å±•ï¼ˆæ•°æ®åº“ã€ç®¡ç†åå°ã€æ”¯ä»˜ç­‰ï¼‰
- âœ… ä¾¿äºç»´æŠ¤ï¼ˆä¿®æ”¹å¥—é¤åªéœ€ä¿®æ”¹åç«¯é…ç½®ï¼‰

